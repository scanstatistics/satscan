#!/bin/sh

(

binaries="/Users/hostovic/prj/satscan.development/build.area/binaries/mac"
satscan_src="/Users/hostovic/prj/satscan.development/build.area/satscan"
boost_src="/Users/hostovic/prj/boost/boost_1_52_0"
processors="-j2"

rm -f $binaries/*


# Intel command-line binaries

echo building SaTScan for 32-bit system using gcc4.0.1 - i386
./makescript.mac.sh $binaries/satscan_gcc4.0.1_i386_32bit $satscan_src $boost_src -m32 -O3 "/usr/bin/g++ -arch i386 -mmacosx-version-min=10.6" $processors

echo building SaTScan for 64-bit system using gcc4.0.1 - x86_64
./makescript.mac.sh $binaries/satscan_gcc4.0.1_x86_64_64bit $satscan_src $boost_src -m64 -O3 "/usr/bin/g++ -arch x86_64 -mmacosx-version-min=10.6" $processors

# Create universal binary - only interested in Intel architectures
echo creating universal binary for 32-bit and 64-bit systems
lipo -create $binaries/satscan_gcc4.0.1_i386_32bit $binaries/satscan_gcc4.0.1_x86_64_64bit -output $binaries/satscan

# Intel JNI libraries

echo building SaTScan shared object for 32-bit system using gcc4.0.1 - i386
./makescript.so.mac.sh $binaries/libsatscan.gcc4.0.1_i386_32bit.jnilib $satscan_src $boost_src -m32 -O3 "/usr/bin/g++ -arch i386  -mmacosx-version-min=10.6" $processors

echo building SaTScan shared object for 64-bit system using gcc4.0.1 - x86_64
./makescript.so.mac.sh $binaries/libsatscan.gcc4.0.1_x86_64_64bit.jnilib $satscan_src $boost_src -m64 -O3 "/usr/bin/g++ -arch x86_64  -mmacosx-version-min=10.6" $processors

# Create universal binary - only interested in Intel architectures
echo creating universal shared object binary for 32-bit and 64-bit systems
lipo -create $binaries/libsatscan.gcc4.0.1_i386_32bit.jnilib $binaries/libsatscan.gcc4.0.1_x86_64_64bit.jnilib -output $binaries/libsatscan.jnilib

) 1> build.stdout 2> build.stderr
